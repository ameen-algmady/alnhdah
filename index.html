<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø© - Ù†Ø¸Ø§Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
  <meta name="description" content="Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø© - Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨ØŒ Ù…Ø­ØµÙ„Ø§Øª Ø´Ù‡Ø±ÙŠØ©ØŒ Ù†ØªØ§Ø¦Ø¬ Ù†ØµÙ Ø§Ù„Ø¹Ø§Ù… ÙˆØ¢Ø®Ø± Ø§Ù„Ø¹Ø§Ù…. Ù†Ø¸Ø§Ù… Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¢Ù…Ù† ÙˆØ³Ø±ÙŠØ¹.">
  
  <!-- PWA Meta Tags -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#1a237e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø©">
  
  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      --primary-color: #1a237e;
      --secondary-color: #4CAF50;
      --accent-color: #2196F3;
      --light-bg: #f8f9fa;
    }
    
    body {
      font-family: 'Tahoma', sans-serif;
      background: linear-gradient(135deg, #f9f9f9 0%, #e8f4f8 100%);
      padding-top: 70px;
    }
    
    .navbar {
      background: linear-gradient(135deg, #1a237e, #283593) !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 12px 0;
      border-bottom: 3px solid #4CAF50;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
    }
    
    .navbar-brand {
      font-weight: bold;
      font-size: 1.4rem;
      color: white !important;
    }
    
    .nav-link {
      font-weight: 500;
      margin: 0 5px;
      border-radius: 25px;
      padding: 8px 16px !important;
      color: white !important;
    }
    
    .nav-link:hover {
      background: rgba(255,255,255,0.2);
    }
    
    header {
      background: linear-gradient(135deg, #1a237e, #283593);
      color: white;
      padding: 80px 20px 40px;
      border-radius: 0 0 40px 40px;
      margin-bottom: 40px;
    }
    
    header h1 {
      font-weight: bold;
      font-size: 2.8rem;
      color: white;
      margin-bottom: 15px;
    }
    
    section {
      padding: 60px 20px;
      margin: 40px auto;
      max-width: 1200px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    section h2 {
      color: #1a237e;
      font-weight: bold;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .btn {
      border-radius: 25px;
      padding: 14px 28px;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #1a237e, #283593);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(26, 35, 126, 0.3);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
    }
    
    footer {
      background: linear-gradient(135deg, #1a237e, #283593);
      color: white;
      padding: 40px 20px;
      text-align: center;
      margin-top: 60px;
      border-radius: 40px 40px 0 0;
    }
    
    /* Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø«Ø§Ø¨Øª */
    #installBtn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 10000;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 15px 25px;
      font-weight: bold;
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s ease;
      display: none;
    }
    
    #installBtn:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(76, 175, 80, 0.5);
    }
    
    /* Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
    #notificationBtn {
      position: fixed;
      bottom: 30px;
      left: 30px;
      z-index: 10000;
      background: linear-gradient(135deg, #2196F3, #1976D2);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 15px 25px;
      font-weight: bold;
      box-shadow: 0 8px 25px rgba(33, 150, 243, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s ease;
    }
    
    #notificationBtn:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(33, 150, 243, 0.5);
    }
    
    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª */
    .announcement-bar {
      position: fixed;
      top: 70px;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #2196F3, #1976D2);
      color: white;
      padding: 12px;
      z-index: 999;
      text-align: center;
      display: none;
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    }
    
    .announcement-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .announcement-close {
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
    }
    
    /* Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ø¦Ù… */
    .floating-notification {
      position: fixed;
      top: 100px;
      right: 20px;
      width: 350px;
      max-width: 90%;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      z-index: 1001;
      border: 2px solid #4CAF50;
      animation: slideInRight 0.5s ease-out;
      display: none;
    }
    
    .notification-content {
      padding: 20px;
      position: relative;
    }
    
    .notification-close {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      cursor: pointer;
    }
    
    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… */
    .system-message {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10002;
      padding: 15px 25px;
      border-radius: 10px;
      color: white;
      text-align: center;
      max-width: 90%;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: messageSlide 0.4s ease-out;
    }
    
    @keyframes messageSlide {
      from { transform: translate(-50%, -100%); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }
    
    @media (max-width: 768px) {
      header h1 {
        font-size: 2.2rem;
      }
      
      section {
        padding: 40px 15px;
        margin: 20px 10px;
      }
      
      #installBtn, #notificationBtn {
        bottom: 20px;
        right: 20px;
        padding: 12px 20px;
        font-size: 14px;
      }
      
      #notificationBtn {
        left: 20px;
      }
      
      .floating-notification {
        width: 90%;
        right: 5%;
      }
    }
  </style>
</head>

<body>
  <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
  <div id="announcementBar" class="announcement-bar">
    <div class="announcement-content">
      <i class="fas fa-bullhorn"></i>
      <span id="announcementText"></span>
      <button class="announcement-close" onclick="closeAnnouncement()">Ã—</button>
    </div>
  </div>

  <!-- Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ø¦Ù… -->
  <div id="floatingNotification" class="floating-notification">
    <div class="notification-content">
      <button class="notification-close" onclick="closeFloatingNotification()">Ã—</button>
      <div id="notificationTitle" class="notification-title h5 mb-2"></div>
      <div id="notificationMessage" class="notification-message"></div>
      <div class="notification-meta mt-3 text-muted small d-flex justify-content-between">
        <span id="notificationTime"></span>
        <span id="notificationType"></span>
      </div>
    </div>
  </div>

  <!-- Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª -->
  <button id="installBtn">
    <i class="fas fa-download"></i> ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  </button>

  <!-- Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
  <button id="notificationBtn">
    <i class="fas fa-bell"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  </button>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="fas fa-graduation-cap me-2"></i>Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="#home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li class="nav-item"><a class="nav-link" href="#results">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</a></li>
          <li class="nav-item"><a class="nav-link" href="#homework">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</a></li>
          <li class="nav-item"><a class="nav-link" href="#about">Ø¹Ù† Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</a></li>
          <li class="nav-item"><a class="nav-link" href="#location">Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <header id="home">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1>Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h1>
          <p class="lead mt-3">Ù†Ø­Ùˆ Ø¬ÙŠÙ„ ÙˆØ§Ø¹ÙŠ.. Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…Ø´Ø±Ù‚</p>
          <p>ØªÙ…ÙŠØ² ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Â· Ø¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ù‡Ø¬ Â· Ø¥Ø¨Ø¯Ø§Ø¹ ÙÙŠ Ø§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨</p>
        </div>
        <div class="col-md-4">
          <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©" class="img-fluid rounded shadow" 
               style="max-height: 150px;" onerror="this.style.display='none'">
        </div>
      </div>
    </div>
  </header>

  <!-- Ø§Ù„Ù…Ø­ØµÙ„Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <section id="results">
    <div class="container">
      <h2><i class="fas fa-chart-line me-2"></i>Ø§Ù„Ù…Ø­ØµÙ„Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
      <p class="text-center mb-4">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ø­ØµÙ„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©.</p>
      <div class="row g-3">
        <div class="col-md-6">
          <a href="results_grade4.html" class="btn btn-primary w-100">
            <i class="fas fa-school me-2"></i>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
        <div class="col-md-6">
          <a href="results_grade4.html" class="btn btn-primary w-100">
            <i class="fas fa-school me-2"></i>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - Ø§Ù„ÙØ±Ø¹
          </a>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© -->
  <section id="homework">
    <div class="container">
      <h2><i class="fas fa-book me-2"></i>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©</h2>
      <p class="text-center mb-4">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©.</p>
      <div class="row g-3">
        <div class="col-md-6">
          <a href="homework1.html" class="btn btn-success w-100">
            <i class="fas fa-book me-2"></i>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª - Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
        <div class="col-md-6">
          <a href="homework1.html" class="btn btn-success w-100">
            <i class="fas fa-book me-2"></i>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª - Ø§Ù„ÙØ±Ø¹
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Ù‚Ø³Ù… Ø¹Ù† Ø§Ù„Ù…Ø¯Ø±Ø³Ø© -->
  <section id="about">
    <div class="container">
      <h2><i class="fas fa-school me-2"></i>Ø¹Ù† Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h2>
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card mb-3">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0"><i class="fas fa-eye me-2"></i>Ø±Ø¤ÙŠØªÙ†Ø§</h5>
            </div>
            <div class="card-body">
              <p>Ø¨Ù†Ø§Ø¡ Ø¬ÙŠÙ„ Ù…ØªÙ…ÙŠØ² Ø¹Ù„Ù…ÙŠØ§Ù‹ ÙˆØ£Ø®Ù„Ø§Ù‚ÙŠØ§Ù‹ØŒ Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¬Ù‡Ø© ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„.</p>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card mb-3">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0"><i class="fas fa-bullhorn me-2"></i>Ù…Ù‡Ù…ØªÙ†Ø§</h5>
            </div>
            <div class="card-body">
              <p>ØªÙ‚Ø¯ÙŠÙ… ØªØ¹Ù„ÙŠÙ… Ù…ØªÙ…ÙŠØ² ÙˆÙÙ‚ Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†Ø§Ù‡Ø¬ ÙˆØ§Ù„ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ -->
  <section id="location">
    <div class="container">
      <h2><i class="fas fa-map-marker-alt me-2"></i>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</h2>
      <div class="ratio ratio-16x9 mt-4">
        <iframe 
          src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d912.8963133105634!2d43.9595699804606!3d15.662670099059982!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e1!3m2!1sar!2s!4v1766099326002!5m2!1sar!2s"
          style="border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          title="Ø®Ø±ÙŠØ·Ø© Ù…ÙˆÙ‚Ø¹ Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©">
        </iframe>
      </div>
      <div class="mt-4">
        <p><i class="fas fa-map-marker-alt text-primary me-2"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø­ÙŠ Ø§Ù„Ù‚Ø´ÙŠØ¨ÙŠ ØŒØ¹Ù…Ø±Ø§Ù†ØŒ Ø§Ù„ÙŠÙ…Ù†</p>
        <p><i class="fas fa-phone text-success me-2"></i> Ø§Ù„Ù‡Ø§ØªÙ: 77</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <h4>Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h4>
      <p>Ù†Ø­Ùˆ Ø¬ÙŠÙ„ ÙˆØ§Ø¹ÙŠ.. Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…Ø´Ø±Ù‚</p>
      <p class="mt-3">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2024</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- ========== Ù†Ø¸Ø§Ù… PWA ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„ ========== -->
  <script>
  // ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª PWA ==========
  let deferredPrompt;
  let swRegistration = null;

  // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ==========
  document.addEventListener('DOMContentLoaded', async () => {
      console.log('ğŸš€ Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø©...');
      
      try {
          // 1. ØªØ³Ø¬ÙŠÙ„ Service Worker
          await registerServiceWorker();
          
          // 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
          setupInstallButton();
          
          // 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
          setupNotificationButton();
          
          // 4. ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
          loadAnnouncements();
          
          // 5. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
          startUpdateMonitoring();
          
          // 6. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³Ù„Ø³
          setupSmoothNavigation();
          
          // 7. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¶Ø¹ PWA
          checkPWAStatus();
          
          console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„');
          
      } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
          showSystemMessage('error', 'Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…');
      }
  });

  // ========== ØªØ³Ø¬ÙŠÙ„ Service Worker ==========
  async function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
          try {
              swRegistration = await navigator.serviceWorker.register('sw.js');
              console.log('âœ… Service Worker Ù…Ø³Ø¬Ù„:', swRegistration.scope);
              
              // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
              if (Notification.permission === 'granted') {
                  showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©', 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„ØªÙ„Ù‚ÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª');
              }
              
          } catch (error) {
              console.error('âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker:', error);
              // Ø¥Ù†Ø´Ø§Ø¡ Service Worker Ø¨Ø³ÙŠØ· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
              createFallbackServiceWorker();
          }
      } else {
          console.log('âš ï¸ Service Worker ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
      }
  }

  function createFallbackServiceWorker() {
      // ÙƒÙˆØ¯ Service Worker Ø¨Ø³ÙŠØ· ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù
      const swCode = `
          self.addEventListener('install', (event) => {
              console.log('Service Worker: Installing...');
              self.skipWaiting();
          });

          self.addEventListener('activate', (event) => {
              console.log('Service Worker: Activated');
          });

          self.addEventListener('push', (event) => {
              const data = event.data.json();
              const options = {
                  body: data.body,
                  icon: 'logo.png',
                  badge: 'logo.png',
                  vibrate: [100, 50, 100],
                  data: {
                      url: data.url || '/'
                  }
              };
              
              event.waitUntil(
                  self.registration.showNotification(data.title, options)
              );
          });

          self.addEventListener('notificationclick', (event) => {
              event.notification.close();
              event.waitUntil(
                  clients.openWindow(event.notification.data.url)
              );
          });
      `;
      
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swURL = URL.createObjectURL(blob);
      
      navigator.serviceWorker.register(swURL)
          .then(reg => console.log('âœ… Fallback Service Worker Ù…Ø³Ø¬Ù„'))
          .catch(err => console.error('âŒ ÙØ´Ù„ Fallback Service Worker:', err));
  }

  // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ«Ø¨ÙŠØª PWA ==========
  function setupInstallButton() {
      const installBtn = document.getElementById('installBtn');
      
      // Ø­Ø¯Ø« beforeinstallprompt
      window.addEventListener('beforeinstallprompt', (e) => {
          console.log('ğŸ¯ Ø­Ø¯Ø« beforeinstallprompt - Ù…ØªØ§Ø­ Ù„Ù„ØªØ«Ø¨ÙŠØª');
          e.preventDefault();
          deferredPrompt = e;
          
          // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
          if (installBtn) {
              installBtn.style.display = 'flex';
          }
          
          // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
          showSystemMessage('info', 'ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 
              'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹', 5000);
      });
      
      // Ø­Ø¯Ø« appinstalled
      window.addEventListener('appinstalled', () => {
          console.log('ğŸ‰ ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!');
          deferredPrompt = null;
          
          // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
          if (installBtn) {
              installBtn.style.display = 'none';
          }
          
          // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
          showSystemMessage('success', 'ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª', 
              'ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
      });
      
      // Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
      if (installBtn) {
          installBtn.addEventListener('click', async () => {
              if (!deferredPrompt) {
                  showSystemMessage('warning', 'ØºÙŠØ± Ù…ØªØ§Ø­', 
                      'Ø®ÙŠØ§Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹');
                  return;
              }
              
              try {
                  installBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ«Ø¨ÙŠØª...';
                  installBtn.disabled = true;
                  
                  deferredPrompt.prompt();
                  const choiceResult = await deferredPrompt.userChoice;
                  
                  if (choiceResult.outcome === 'accepted') {
                      console.log('âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ«Ø¨ÙŠØª');
                  } else {
                      console.log('âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ«Ø¨ÙŠØª');
                      installBtn.innerHTML = '<i class="fas fa-download"></i> ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
                      installBtn.disabled = false;
                  }
                  
                  deferredPrompt = null;
                  
              } catch (error) {
                  console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ«Ø¨ÙŠØª:', error);
                  installBtn.innerHTML = '<i class="fas fa-download"></i> ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
                  installBtn.disabled = false;
                  showSystemMessage('error', 'Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª');
              }
          });
      }
  }

  function checkPWAStatus() {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø«Ø¨ØªØ§Ù‹ ÙƒÙ€ PWA
      if (window.matchMedia('(display-mode: standalone)').matches || 
          window.navigator.standalone === true) {
          console.log('ğŸ“± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ ÙƒÙ€ PWA');
          document.getElementById('installBtn').style.display = 'none';
      }
  }

  // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ==========
  function setupNotificationButton() {
      const notificationBtn = document.getElementById('notificationBtn');
      
      if (!notificationBtn) return;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø°Ù† Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      updateNotificationButton();
      
      // Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
      notificationBtn.addEventListener('click', async () => {
          if (!('Notification' in window)) {
              showSystemMessage('warning', 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…', 
                  'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
              return;
          }
          
          if (Notification.permission === 'granted') {
              // Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ
              await testNotification();
          } else if (Notification.permission === 'default') {
              // Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù†
              const permission = await Notification.requestPermission();
              
              if (permission === 'granted') {
                  showSystemMessage('success', 'ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„', 
                      'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                  await testNotification();
              } else {
                  showSystemMessage('warning', 'ØªÙ… Ø§Ù„Ø±ÙØ¶', 
                      'ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„ØªÙ„Ù‚ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª');
              }
              
              updateNotificationButton();
          } else {
              // Ø§Ù„Ø¥Ø°Ù† Ù…Ø±ÙÙˆØ¹ - ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­
              showSystemMessage('warning', 'Ø§Ù„Ø¥Ø°Ù† Ù…Ø±ÙÙˆØ¶', 
                  'ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­');
          }
      });
  }

  function updateNotificationButton() {
      const notificationBtn = document.getElementById('notificationBtn');
      if (!notificationBtn) return;
      
      if (!('Notification' in window)) {
          notificationBtn.style.display = 'none';
          return;
      }
      
      if (Notification.permission === 'granted') {
          notificationBtn.innerHTML = '<i class="fas fa-bell"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±';
          notificationBtn.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
      } else if (Notification.permission === 'denied') {
          notificationBtn.innerHTML = '<i class="fas fa-bell-slash"></i> Ø§Ù„Ø¥Ø°Ù† Ù…Ø±ÙÙˆØ¶';
          notificationBtn.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
      } else {
          notificationBtn.innerHTML = '<i class="fas fa-bell"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª';
          notificationBtn.style.background = 'linear-gradient(135deg, #2196F3, #1976D2)';
      }
  }

  async function testNotification() {
      try {
          // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø¨Ø± Service Worker
          if (swRegistration && Notification.permission === 'granted') {
              await swRegistration.showNotification('ğŸ”” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… - Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø©', {
                  body: 'Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª. Ø¥Ø°Ø§ Ø§Ø³ØªÙ„Ù…Øª Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±ØŒ ÙØ§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!',
                  icon: 'logo.png',
                  badge: 'logo.png',
                  vibrate: [200, 100, 200],
                  tag: 'test-notification',
                  renotify: true,
                  actions: [
                      {
                          action: 'open',
                          title: 'ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚'
                      }
                  ]
              });
              
              showSystemMessage('success', 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 
                  'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!');
          } else {
              // Ø¥Ø´Ø¹Ø§Ø± Ù…Ø¨Ø§Ø´Ø± Ø¥Ø°Ø§ ÙØ´Ù„ Service Worker
              const notification = new Notification('ğŸ”” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… - Ù…Ø¯Ø§Ø±Ø³ Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø¶Ø©', {
                  body: 'Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª. Ø¥Ø°Ø§ Ø§Ø³ØªÙ„Ù…Øª Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±ØŒ ÙØ§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!',
                  icon: 'logo.png',
                  badge: 'logo.png'
              });
              
              notification.onclick = () => {
                  window.focus();
                  notification.close();
              };
              
              showSystemMessage('success', 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 
                  'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!');
          }
          
      } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:', error);
          showSystemMessage('error', 'Ø®Ø·Ø£', 'ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±');
      }
  }

  // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ==========
  async function loadAnnouncements() {
      try {
          // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù Ø®Ø§Ø±Ø¬ÙŠ
          const response = await fetch('notifications.json?v=' + Date.now());
          if (response.ok) {
              const data = await response.json();
              processAnnouncements(data.notifications || []);
          }
      } catch (error) {
          console.log('ğŸ“ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
          // ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage
          const localAnnouncements = localStorage.getItem('jeel_announcements');
          if (localAnnouncements) {
              processAnnouncements(JSON.parse(localAnnouncements));
          }
      }
  }

  function processAnnouncements(announcements) {
      if (!announcements || announcements.length === 0) return;
      
      // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
      const activeAnnouncements = announcements.filter(ann => 
          ann.status === 'active' && (!ann.expiry || new Date(ann.expiry) > new Date())
      );
      
      if (activeAnnouncements.length === 0) return;
      
      // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
      localStorage.setItem('jeel_announcements', JSON.stringify(activeAnnouncements));
      
      // Ø¹Ø±Ø¶ Ø£Ø­Ø¯Ø« Ø¥Ø¹Ù„Ø§Ù†
      const latestAnnouncement = activeAnnouncements[0];
      displayAnnouncement(latestAnnouncement);
      
      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù… ÙŠØ±Ù‡ Ù…Ø¤Ø®Ø±Ø§Ù‹
      if (shouldSendNotification(latestAnnouncement)) {
          sendAnnouncementNotification(latestAnnouncement);
      }
  }

  function displayAnnouncement(announcement) {
      if (!announcement) return;
      
      // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ
      const announcementBar = document.getElementById('announcementBar');
      const announcementText = document.getElementById('announcementText');
      
      if (announcementBar && announcementText) {
          announcementText.textContent = announcement.title;
          announcementBar.style.display = 'block';
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…
      updateFloatingNotification(announcement);
      
      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
      markAsViewed(announcement.id);
  }

  function updateFloatingNotification(announcement) {
      const notification = document.getElementById('floatingNotification');
      if (!notification) return;
      
      document.getElementById('notificationTitle').textContent = announcement.title;
      document.getElementById('notificationMessage').textContent = announcement.message;
      
      const date = new Date(announcement.created);
      document.getElementById('notificationTime').textContent = 
          date.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
      
      const typeText = {
          info: 'ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø§Ù…',
          success: 'âœ… Ø¥Ø¹Ù„Ø§Ù† Ù‡Ø§Ù…',
          warning: 'âš ï¸ ØªØ­Ø°ÙŠØ±',
          danger: 'ğŸš¨ Ø·Ø§Ø±Ø¦'
      }[announcement.type] || 'ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù†';
      
      document.getElementById('notificationType').textContent = typeText;
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
      notification.style.display = 'block';
      
      // Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ
      setTimeout(() => {
          if (notification.style.display === 'block') {
              closeFloatingNotification();
          }
      }, 10000);
  }

  function shouldSendNotification(announcement) {
      if (!announcement.urgent) return false;
      if (Notification.permission !== 'granted') return false;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù…Ø³Ø¨Ù‚Ø§Ù‹
      const sentNotifications = JSON.parse(localStorage.getItem('jeel_sent_notifications') || '{}');
      return !sentNotifications[announcement.id];
  }

  function sendAnnouncementNotification(announcement) {
      if (!('Notification' in window) || Notification.permission !== 'granted') return;
      
      try {
          // Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Service Worker
          if (swRegistration) {
              swRegistration.showNotification(announcement.title, {
                  body: announcement.message.substring(0, 120),
                  icon: 'logo.png',
                  badge: 'logo.png',
                  tag: 'announcement-' + announcement.id,
                  requireInteraction: announcement.urgent,
                  vibrate: announcement.urgent ? [200, 100, 200, 100, 200] : [100, 50, 100],
                  data: {
                      url: window.location.href,
                      announcementId: announcement.id
                  }
              });
          } else {
              // Ø¥Ø´Ø¹Ø§Ø± Ù…Ø¨Ø§Ø´Ø±
              const notification = new Notification(announcement.title, {
                  body: announcement.message.substring(0, 120),
                  icon: 'logo.png'
              });
              
              notification.onclick = () => {
                  window.focus();
                  notification.close();
              };
          }
          
          // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
          const sentNotifications = JSON.parse(localStorage.getItem('jeel_sent_notifications') || '{}');
          sentNotifications[announcement.id] = Date.now();
          localStorage.setItem('jeel_sent_notifications', JSON.stringify(sentNotifications));
          
      } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:', error);
      }
  }

  function markAsViewed(announcementId) {
      try {
          const viewedAnnouncements = JSON.parse(localStorage.getItem('jeel_viewed_announcements') || '{}');
          viewedAnnouncements[announcementId] = Date.now();
          localStorage.setItem('jeel_viewed_announcements', JSON.stringify(viewedAnnouncements));
      } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©:', error);
      }
  }

  // ========== Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ==========
  function startUpdateMonitoring() {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
      setInterval(checkForUpdates, 60000);
      
      // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª localStorage
      window.addEventListener('storage', (e) => {
          if (e.key === 'jeel_system_update') {
              console.log('ğŸ”„ ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØ­Ø¯ÙŠØ« Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
              loadAnnouncements();
          }
      });
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙˆØ±Ø§Ù‹
      setTimeout(checkForUpdates, 5000);
  }

  async function checkForUpdates() {
      try {
          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Service Worker
          if (swRegistration) {
              await swRegistration.update();
          }
          
          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
          await loadAnnouncements();
          
      } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:', error);
      }
  }

  // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ==========
  function closeAnnouncement() {
      document.getElementById('announcementBar').style.display = 'none';
  }

  function closeFloatingNotification() {
      document.getElementById('floatingNotification').style.display = 'none';
  }

  function setupSmoothNavigation() {
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function(e) {
              const targetId = this.getAttribute('href');
              if (targetId === '#') return;
              
              const targetElement = document.querySelector(targetId);
              if (targetElement) {
                  e.preventDefault();
                  window.scrollTo({
                      top: targetElement.offsetTop - 80,
                      behavior: 'smooth'
                  });
              }
          });
      });
  }

  function showSystemMessage(type, title, message, duration = 4000) {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
      const oldMessages = document.querySelectorAll('.system-message');
      oldMessages.forEach(msg => msg.remove());
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      const msgDiv = document.createElement('div');
      msgDiv.className = `system-message`;
      
      const bgColor = {
          success: 'linear-gradient(135deg, #4CAF50, #2E7D32)',
          error: 'linear-gradient(135deg, #f44336, #d32f2f)',
          warning: 'linear-gradient(135deg, #FF9800, #F57C00)',
          info: 'linear-gradient(135deg, #2196F3, #1976D2)'
      }[type] || bgColor.info;
      
      msgDiv.style.background = bgColor;
      
      msgDiv.innerHTML = `
          <h6 class="mb-1" style="font-weight: bold;">${title}</h6>
          <p class="mb-0" style="font-size: 14px;">${message}</p>
      `;
      
      document.body.appendChild(msgDiv);
      
      // Ø¥Ø®ÙØ§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ
      setTimeout(() => {
          msgDiv.style.opacity = '0';
          msgDiv.style.transform = 'translate(-50%, -20px)';
          setTimeout(() => msgDiv.remove(), 500);
      }, duration);
  }

  // ========== Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ==========
  function showNotification(title, body) {
      if (!('Notification' in window) || Notification.permission !== 'granted') {
          return;
      }
      
      const options = {
          body: body,
          icon: 'logo.png',
          badge: 'logo.png',
          vibrate: [100, 50, 100]
      };
      
      if (swRegistration) {
          swRegistration.showNotification(title, options);
      } else {
          new Notification(title, options);
      }
  }

  // ========== Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ==========
  window.testNotification = testNotification;
  window.showSystemMessage = showSystemMessage;
  </script>
</body>
</html>