<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Ù†ÙØ³ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }
        body { background-color: #f5f9ff; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white; padding: 20px 0; text-align: center;
            border-radius: 0 0 15px 15px; margin-bottom: 20px;
        }
        
        .grades-container { display: flex; flex-direction: column; gap: 20px; }
        .grade-section { background: white; border-radius: 10px; padding: 15px; }
        .section-title { color: #1e3c72; margin-bottom: 15px; font-size: 1.2rem; }
        .grades-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; }
        
        .grade-card {
            background: #f8fafd; border-radius: 8px; padding: 15px 10px;
            text-align: center; cursor: pointer; border: 2px solid #e8efff;
            transition: all 0.3s;
        }
        .grade-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .grade-card i { font-size: 1.8rem; color: #2a5298; margin-bottom: 8px; }
        .grade-card h3 { font-size: 1.1rem; margin-bottom: 5px; }
        .grade-card .section { background: #2a5298; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8rem; }
        
        .mobile-warning {
            background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px;
            margin: 10px 0; text-align: center; display: none;
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .grades-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
            .mobile-warning { display: block; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-book-open"></i> Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©</h1>
            <p>Ø§Ø®ØªØ± Ø§Ù„ØµÙ ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</p>
        </div>
    </header>
    
    <div class="container">
        <div id="mobile-warning" class="mobile-warning">
            <i class="fas fa-mobile-alt"></i>
            <span id="mobile-status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...</span>
        </div>
        
        <div id="message" class="message" style="display:none;"></div>
        <div id="grades-container" class="grades-container"></div>
        <div id="homework-container" class="homework-table" style="display:none;"></div>
        <div id="loading" class="loading" style="display:none;">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>
    
    <script>
        // ğŸ”´ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§ ğŸ”´
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw-GGmcGBJjT_RGdZmZwBGG0sBEUEofKSlqZ2LpQ5pcNs5dNFJMRQ9DBOzZHtVzkT-v/exec';
        
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙØµÙˆÙ„
        const schoolGrades = [
            { title: "Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©", icon: "fas fa-child", grades: [
                { id: "Ø§Ù„Ø£ÙˆÙ„", name: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„", sections: ["Ø£"] },
                { id: "Ø§Ù„Ø«Ø§Ù†ÙŠ", name: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ", sections: ["Ø£"] },
                { id: "Ø§Ù„Ø«Ø§Ù„Ø«", name: "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«", sections: ["Ø£"] }
            ]},
            { title: "Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹", icon: "fas fa-graduation-cap", grades: [
                { id: "Ø§Ù„Ø±Ø§Ø¨Ø¹", name: "Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹", sections: ["Ø£","Ø¨","Ø¬"] }
            ]},
            { title: "Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³", icon: "fas fa-graduation-cap", grades: [
                { id: "Ø§Ù„Ø®Ø§Ù…Ø³", name: "Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³", sections: ["Ø£","Ø¨","Ø¬"] }
            ]}
        ];
        
        // ÙƒØ´Ù Ø§Ù„Ù‡Ø§ØªÙ
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // ğŸ”´ Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ Ø£ÙˆÙ„Ø§Ù‹ ğŸ”´
        function initializeForMobile() {
            if (!isMobile) return;
            
            document.getElementById('mobile-status').textContent = 'Ø¬Ø§Ø±ÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„Ù‡Ø§ØªÙ...';
            
            // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø·Ù„Ø¨ Ø¨Ø³ÙŠØ· Ø¬Ø¯Ø§Ù‹ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª
            const pingUrl = `${SCRIPT_URL}?action=ping&callback=mobilePing&_=${Date.now()}`;
            
            window.mobilePing = function(data) {
                delete window.mobilePing;
                if (data && data.success) {
                    document.getElementById('mobile-status').textContent = 'âœ“ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…ÙØ¹Ù„ Ù„Ù„Ù‡Ø§ØªÙ';
                    document.getElementById('mobile-warning').style.background = '#d4edda';
                    document.getElementById('mobile-warning').style.color = '#155724';
                    
                    // Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­ØŒ Ø¬Ø±Ø¨ test connection
                    setTimeout(() => testConnection(), 1000);
                } else {
                    document.getElementById('mobile-status').textContent = 'âš ï¸ Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„';
                    document.getElementById('mobile-warning').style.cursor = 'pointer';
                    document.getElementById('mobile-warning').onclick = activateMobileAccess;
                }
            };
            
            const script = document.createElement('script');
            script.src = pingUrl;
            script.onerror = () => {
                document.getElementById('mobile-status').textContent = 'âŒ Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„';
                document.getElementById('mobile-warning').style.cursor = 'pointer';
                document.getElementById('mobile-warning').onclick = activateMobileAccess;
            };
            document.body.appendChild(script);
        }
        
        // ğŸ”´ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ğŸ”´
        function activateMobileAccess() {
            if (!isMobile) return;
            
            // Ø§ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„
            const authUrl = `${SCRIPT_URL}?action=test`;
            window.open(authUrl, '_blank');
            
            // Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠØŒ Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹
            setTimeout(() => {
                document.getElementById('mobile-status').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰...';
                initializeForMobile();
            }, 3000);
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ù‡ÙˆØ§ØªÙ
        function loadHomework(grade, section, gradeName) {
            console.log(`ğŸ“± ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ø¨Ø§Øª ${gradeName} Ø¹Ù„Ù‰ ${isMobile ? 'Ù‡Ø§ØªÙ' : 'Ø­Ø§Ø³ÙˆØ¨'}`);
            
            document.getElementById('grades-container').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            
            // ğŸ”´ Ù…ÙØªØ§Ø­ Ø§Ù„Ø­Ù„: Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ù‡Ø§ØªÙ ğŸ”´
            const callbackName = 'hw_' + Date.now();
            const timestamp = Date.now();
            const deviceType = isMobile ? 'mobile' : 'desktop';
            
            window[callbackName] = function(data) {
                delete window[callbackName];
                document.getElementById('loading').style.display = 'none';
                
                if (data && data.success) {
                    showHomeworkTable(grade, section, gradeName, data);
                    showMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ø¨Ø§Øª ${gradeName}`, 'success');
                } else {
                    let errorMsg = data?.error || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„';
                    
                    if (isMobile) {
                        errorMsg += '<br><small>Ø­Ø§ÙˆÙ„: 1. Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© 2. ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©</small>';
                    }
                    
                    showMessage(errorMsg, 'error');
                    showGradesList();
                }
            };
            
            // ğŸ”´ URL Ù…Ø­Ø³Ù† Ù„Ù„Ù‡ÙˆØ§ØªÙ ğŸ”´
            const url = `${SCRIPT_URL}?action=getHomework&grade=${encodeURIComponent(grade)}&section=${encodeURIComponent(section)}&callback=${callbackName}&device=${deviceType}&_t=${timestamp}&mode=simple`;
            
            const script = document.createElement('script');
            script.src = url;
            
            script.onerror = function() {
                delete window[callbackName];
                document.getElementById('loading').style.display = 'none';
                
                if (isMobile) {
                    showMessage(`
                        ğŸ“± <strong>Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ</strong><br>
                        <button onclick="window.open('${SCRIPT_URL}?action=test', '_blank')" style="background:#28a745;color:white;border:none;padding:8px 15px;border-radius:5px;margin-top:10px;">
                            Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„
                        </button>
                    `, 'error');
                } else {
                    showMessage('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
                }
                showGradesList();
            };
            
            // Timeout Ø£Ù‚Ù„ Ù„Ù„Ù‡ÙˆØ§ØªÙ
            setTimeout(() => {
                if (window[callbackName]) {
                    delete window[callbackName];
                    document.getElementById('loading').style.display = 'none';
                    
                    if (isMobile) {
                        showMessage('â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø·ÙˆÙŠÙ„ØŒ Ø¬Ø±Ø¨ Wi-Fi', 'info');
                    }
                    showGradesList();
                }
            }, isMobile ? 10000 : 15000);
            
            document.body.appendChild(script);
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø­Ø³Ù†
        function testConnection() {
            const callbackName = 'test_' + Date.now();
            
            window[callbackName] = function(data) {
                delete window[callbackName];
                
                if (data && data.success) {
                    const msg = isMobile ? 
                        `ğŸ“± <strong>Ø§Ù„Ù‡Ø§ØªÙ Ù…ØªØµÙ„!</strong><br>Ø¬Ø±Ø¨ ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ø¨Ø§Øª` : 
                        `ğŸ’» <strong>Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ Ù…ØªØµÙ„!</strong>`;
                    showMessage(msg, 'success');
                } else {
                    showMessage(`âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${data?.error || ''}`, 'error');
                }
            };
            
            const url = `${SCRIPT_URL}?action=test&callback=${callbackName}&_=${Date.now()}`;
            const script = document.createElement('script');
            script.src = url;
            document.body.appendChild(script);
        }
        
        // Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„
        function showMessage(text, type) {
            const el = document.getElementById('message');
            el.innerHTML = text;
            el.className = `message ${type}`;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 4000);
        }
        
        function renderGrades() {
            const container = document.getElementById('grades-container');
            container.innerHTML = '';
            
            schoolGrades.forEach(section => {
                const div = document.createElement('div');
                div.className = 'grade-section';
                div.innerHTML = `
                    <div class="section-title"><i class="${section.icon}"></i> ${section.title}</div>
                    <div class="grades-grid">
                        ${section.grades.map(grade => 
                            grade.sections.map(s => `
                                <div class="grade-card" data-grade="${grade.id}" data-section="${s}">
                                    <i class="${section.icon}"></i>
                                    <h3>${grade.name}</h3>
                                    <div class="section">${s}</div>
                                </div>
                            `).join('')
                        ).join('')}
                    </div>
                `;
                
                div.querySelectorAll('.grade-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const grade = this.getAttribute('data-grade');
                        const section = this.getAttribute('data-section');
                        loadHomework(grade, section, `Ø§Ù„ØµÙ ${grade} - ${section}`);
                    });
                });
                
                container.appendChild(div);
            });
        }
        
        function showGradesList() {
            document.getElementById('homework-container').style.display = 'none';
            document.getElementById('grades-container').style.display = 'block';
        }
        
        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        document.addEventListener('DOMContentLoaded', function() {
            renderGrades();
            
            if (isMobile) {
                // Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ: Ø¨Ø¯Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹
                initializeForMobile();
            } else {
                // Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨: Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¨Ø§Ø´Ø±
                setTimeout(() => testConnection(), 1000);
            }
        });
    </script>
</body>
</html>